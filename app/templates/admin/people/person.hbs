{{title model.name}}

<div class="details full-height">
	<div class="section-header">
		<div class="row full-height">
			<div class="xs-3-row-20 s-row-10 display-xs display-xs display-s
                full-height row ">
                {{#link-to params=backRouteParams classNames="pull-left"}}
					<span class="pad-all">
						<span class="icon-left-arrow"></span>
					</span>
            	{{/link-to}}
            </div>
			<div class="xs-11-row-20 s-7-row-10 m-14-row-20 l-15-row-20
                full-height contact-info
                {{if model.hasTeams "has-details"}}">
				<div class="contact-summary">
                    <div class="horizontal-items">
                        <span class="clear-badge no-space">
                            <h5>{{model.name}}</h5>
                        </span>
                        {{#if model.isAdmin}}
							<span class="display-s display-m display-l">
								<span class="margin-l badge">Admin</span>
							</span>
						{{/if}}
                    </div>
                </div>
                <div class="contact-details">
                    <div class="horizontal-items full-height">
                        <span class="clickable display-l"
                            tabindex="0"
                            onclick={{service-action "slideout/teamMembershipService" "openSlideout" model}}>
							{{#each model.teams as |team|}}
				                {{color-badge classNames="clickable"
                                    text=team.name
                                    color=team.hexColor}}
				            {{/each}}
                        </span>
                    </div>
                </div>
            </div>
			<div class="xs-6-row-20 s-2-row-10 m-6-row-20 l-5-row-20
                full-height row">
                <div class="horizontal-items pull-right">
					{{#if (not model.isAuthUser)}}
                        <span class="clear-badge no-space">
                            {{#pop-over as |popOver|}}
                                <button class="btn"
                                    type="button"
                                    onclick={{popOver.actions.toggle}}>
                                    More
                                    <span class="icon-thin-down-arrow"></span>
                                </button>
                            {{else}}
                                <ul class="dropdown">
                                    <li tabindex="0"
                                        class="dropdown-item"
                                        onclick={{service-action "passwordResetService" "getToken" model.username}}>
                                        Send password reset
                                    </li>
                                    <li tabindex="0"
                                        class="dropdown-item"
                                        onclick={{service-action "slideout/teamMembershipService" "openSlideout" model}}>
                                        Teams
                                        <span class="badge">
                                            {{model.teams.content.length}}
                                        </span>
                                    </li>
                                    <li class="dropdown-divider"></li>
                                    {{status-list/staff shouldShow=(and model (not model.isAuthUser))
                                        currentStatus=model.status
                                        onChange=(service-action "staffService" "updateStatus" model)}}
                                </ul>
                            {{/pop-over}}
                        </span>
                    {{else}}
                    	<span class="clear-badge no-space">
                            <button type="button"
                                class="btn"
                                onclick={{service-action "slideout/teamMembershipService" "openSlideout" model}}>
                                Teams
                                <span class="badge tint">
                                    {{model.teams.content.length}}
                                </span>
                            </button>
                        </span>
                    {{/if}}
                    <span class="clear-badge display-m display-l">
                        {{#link-to params=backRouteParams}}
							<span class="pad-all">
								<span class="icon-x"></span>
							</span>
		            	{{/link-to}}
                    </span>
				</div>
            </div>
		</div>
    </div>
    <div class="section-body bg-color bg-lightest">
        {{#tab-container onChange=(service-action "dataService" "revert" model)
            animation="fade" as |personSettingsTabs|}}
            {{#tab-container/item doRegister=personSettingsTabs.actions.register
                onDestroy=personSettingsTabs.actions.unregister
                title="Details"}}
                {{#model-form/staff staff=model
                    canModifyPhone=true
                    onSearchAvailableNumbers=(service-action "numberService" "listAvailable")
                    onRevert=(service-action "dataService" "revert" model)
                    onSave=(service-action "dataService" "persist" model)
                    onUpdateLockCode=(service-action "staffService" "updateLockCode" model)
                    onUpdatePassword=(service-action "staffService" "updatePassword" model)
                    onUpdateUsername=(service-action "staffService" "updateUsername" model)
                    onValidateCredentials=(service-action "validateAuthService" "checkPassword"
                        model.username)
                    as |staffForm|}}
                    {{#if (and model.isDirty (not staffForm.isModifyingAPropertyRequiringConfirm))}}
                        <div class="flex flex--justify-center flex--spacing-between">
                            <div class="flex__item">
                                <button class="btn"
                                    type="button"
                                    onclick={{service-action "dataService" "revert" model}}>
                                    Cancel
                                </button>
                            </div>
                            <div class="flex__item">
                                {{async-button classNames="btn btn-default"
                                    disableWhen=(not (v-get model "isValid"))
                                    action=(service-action "phoneService" "persistPhoneOwner" model)
                                    default="Update"
                                    pending="Updating..."}}
                            </div>
                        </div>
                    {{/if}}
                {{/model-form/staff}}
            {{/tab-container/item}}
            {{#if model.allActivePhoneOwners}}
                {{#tab-container/item classNames="pad-all"
                    doRegister=personSettingsTabs.actions.register
                    onDestroy=personSettingsTabs.actions.unregister
                    title=(concat "Availability (" model.allActivePhoneOwners.length " " (pluralize "phone" model.allActivePhoneOwners.length)")")}}
                    {{#tab-container classNames="flex__item tab-container--nav-outline"
                        animation="fade" as |phoneAvailabilityTabs|}}
                        {{#each model.allActivePhoneOwners as |phoneOwner|}}
                            {{#tab-container/item classNames="pad-t flex flex--direction-vertical flex--align-stretch flex--spacing-between"
                                doRegister=phoneAvailabilityTabs.actions.register
                                onDestroy=phoneAvailabilityTabs.actions.unregister
                                title=(concat phoneOwner.name " - " (phone-number phoneOwner.phone.content.number))}}
                                {{#if phoneOwner.isDirty}}
                                    <div class="flex__item flex flex--justify-center flex--spacing-between">
                                        <div class="flex__item">
                                            <button class="btn" type='button'
                                            onclick={{service-action "dataService" "revert" phoneOwner}}>
                                                Cancel
                                            </button>
                                        </div>
                                        <div class="flex__item">
                                            {{async-button classNames='btn btn-default'
                                            action=(service-action "dataService" "persist" phoneOwner)
                                            default='Update'
                                            pending='Updating...'}}
                                        </div>
                                    </div>
                                {{/if}}
                                {{availability-control
                                    self=(owner-policy/self phoneOwner.phone.content model)
                                    others=(owner-policy/others phoneOwner.phone.content model)
                                    onAvailabilityTypeChange=(action
                                        (mut (get (owner-policy/self phoneOwner.phone.content model) "schedule.manual")))
                                    onManualAvailabilityChange=(action
                                        (mut (get (owner-policy/self phoneOwner.phone.content model) "schedule.manualIsAvailable")))
                                    onScheduleAvailabilityChange=(service-action "scheduleService" "replaceRange"
                                        (get (owner-policy/self phoneOwner.phone.content model) "schedule"))}}
                                {{#if phoneOwner.isDirty}}
                                    <div class="flex__item flex flex--justify-center flex--spacing-between">
                                        <div class="flex__item">
                                            <button class="btn" type='button'
                                            onclick={{service-action "dataService" "revert" phoneOwner}}>
                                                Cancel
                                            </button>
                                        </div>
                                        <div class="flex__item">
                                            {{async-button classNames='btn btn-default'
                                            action=(service-action "dataService" "persist" phoneOwner)
                                            default='Update'
                                            pending='Updating...'}}
                                        </div>
                                    </div>
                                {{/if}}
                            {{/tab-container/item}}
                        {{/each}}
                    {{/tab-container}}
                {{/tab-container/item}}
            {{/if}}
        {{/tab-container}}
    </div>
</div>
