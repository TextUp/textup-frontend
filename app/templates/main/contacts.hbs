{{#if tag}}
    {{title tag.name separator=' - '}}
{{/if}}

<div class="content">
    {{#if tag}}
        <div class="section-header">
            <span class="display-l">
                <span class="indicator pull-left"
                    style='background-color:{{tag.hexColor}};'></span>
            </span>
            <div class="tag-title">
                <h4 class="text-ellipsis">
                    {{tag.name}}
                </h4>
                {{#if (not tag.isDeleted)}}
                    <p>
                        {{numContacts}}
                        {{pluralize 'contact' numContacts}}
                    </p>
                {{/if}}
            </div>
            {{#if (not (or tag.isDeleted tag.hasDirtyAttributes))}}
                {{#link-to 'main.tag.details'
                    classNames='pull-right-to-edge full-height'
                    activeClass='bg-color bg-dark'}}
                    {{#tool-tipster theme='tooltipster-clean'
                        title='View Tag Details'
                        tagName='button'
                        classNames='btn btn-plain btn-expand'}}
                        <span class="fa fa-sliders"></span>
                    {{/tool-tipster}}
                {{/link-to}}
            {{/if}}
        </div>
    {{else}}
        {{#hide-away tabindex=false
            clickOutToClose=true
            bodyClickClose=true
            animation='slide'
            allowedTriggerSelectors='.pull-right' as |hideAway|}}
            <ul class="reset-list">
                <li class="menu-item {{if (eq filter 'all') 'active'}}"
                    {{action 'changeFilter' 'all'}}>
                    <div class="offset-xs-row-10 xs-8-row-10 text-left">
                        <p class="text-bold text-ellipsis">All</p>
                    </div>
                </li>
                <li class="menu-item {{if (eq filter 'unread') 'active'}}"
                    {{action 'changeFilter' 'unread'}}>
                    <div class="offset-xs-row-10 xs-8-row-10 text-left">
                        <p class="text-bold text-ellipsis">Unread</p>
                    </div>
                </li>
                <li class="menu-item {{if (eq filter 'archived') 'active'}}"
                    {{action 'changeFilter' 'archived'}}>
                    <div class="offset-xs-row-10 xs-8-row-10 text-left">
                        <p class="text-bold text-ellipsis">Archived</p>
                    </div>
                </li>
                <li class="menu-item {{if (eq filter 'blocked') 'active'}}"
                    {{action 'changeFilter' 'blocked'}}>
                    <div class="offset-xs-row-10 xs-8-row-10 text-left">
                        <p class="text-bold text-ellipsis">Blocked</p>
                    </div>
                </li>
            </ul>
        {{else}}
            <div class="section-header">
                <div class="contacts-title">
                    <h4 class="text-ellipsis">{{capitalize filter}}</h4>
                    <p>
                        {{numContacts}}
                        {{if (eq numContacts 1) 'contact' 'contacts'}}
                    </p>
                </div>
                <div class="pull-right display-l">
                    <button class="btn btn-plain" type='button'>
                        <span class="fa fa-filter"></span>
                    </button>
                </div>
            </div>
        {{/hide-away}}
    {{/if}}
    {{#infinite-scroll classNames='section-body bg-color bg-dark'
        doRegister=(action (mut _contactsList))
        containerClass='bg-color bg-lightest'
        itemsClass='result-list'
        direction='down'
        data=contacts
        total=numContacts
        doLoad=(action 'loadMore')
        doRefresh=(action 'refresh') as |contact|}}
        <div class="result-item row">
            <div class="contacts-control {{if contact.isSelected 'selected'}}"
                {{action 'toggleSelected' contact preventDefault=false}}>
                <span class="fa fa-check center"></span>
            </div>
            {{#link-to (if tag
                    'main.tag.contact'
                    'main.contacts.contact')
                    contact.id
                tagName="div"}}
                <div class='contacts-info {{if contact.isUnread "unread"}}'>
                    <p class="emphasize">
                        <span class="margin-r-half">
                            {{phone-number contact.identifier}}
                        </span>
                        <span class="clear-badge no-space">
                            {{partial 'partials/contact/indicators'}}
                        </span>
                    </p>
                    <p>
                        {{moment-from-now contact.lastRecordActivity interval=1000}}
                    </p>
                </div>
            {{/link-to}}
            {{#if (and (not contact.isShared) contact.tags)}}
                <div class="contacts-tags">
                    {{#each contact.tags as |tag|}}
                        {{preview-badge color=tag.hexColor content=tag.name}}
                    {{/each}}
                </div>
            {{/if}}
        </div>
    {{else}}
        {{#if (and (eq filter 'all') (not tag))}}
            <div class="no-results">
                No contacts yet!
                <a href='' {{action 'toggleSlideout' 'slideouts/contact' 'main'}}>
                    Get started by creating a new contact.
                </a>
            </div>
        {{else if tag}}
            <div class="no-results">
                No contacts have been added to
                <span class="text-bold">{{tag.name}}</span>
                yet.
            </div>
        {{else}}
            <div class="no-results">No contacts match this criteria.</div>
        {{/if}}
    {{/infinite-scroll}}
</div>
{{outlet}}
